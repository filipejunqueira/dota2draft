# Dota 2 Draft Assistant

This project is a command-line application designed to fetch, analyze, and predict Dota 2 match outcomes based on hero drafts. It provides a suite of tools to gather data from the OpenDota API, store it in a local SQLite database, perform detailed laning-phase analysis, and train a neural network to predict lane scores.

## Project Structure

The project has been refactored into a modular Python package for better organization and maintainability:

```
.dota2_draft_nn/
├── dota2draft/               # Main application package
│   ├── __init__.py
│   ├── api.py                # Handles communication with the OpenDota API.
│   ├── analysis.py           # Contains logic for lane analysis and data visualization.
│   ├── core.py               # Orchestrates data flow between API, DB, and other components.
│   ├── db.py                 # Manages the local SQLite database.
│   └── model.py              # Defines the PyTorch neural network and related functions.
├── dota2draft_cli.py         # The single command-line entry point for the application.
├── opendota_league_info.db   # Local SQLite database for caching API data.
├── lanes.csv                 # Default output file for lane analysis exports.
├── requirements.txt          # Lists all Python dependencies.
└── README.md                 # This file.
```

## Setup

1.  **Clone the repository** (if you haven't already).

2.  **Install dependencies**: It is recommended to use a virtual environment. Navigate to the project root directory and run:
    ```bash
    pip install -r requirements.txt
    ```

## Usage

All functionalities are accessed through `dota2draft_cli.py`. You can see a list of all available commands by running:

```bash
python dota2draft_cli.py --help
```

### Data Fetching & Management

First, you need to populate your local database with data from the OpenDota API.

1.  **Refresh Static Data**: It's good practice to start by getting the latest list of heroes, teams, and leagues.
    ```bash
    python dota2draft_cli.py refresh-static
    ```

2.  **Fetch League Matches**: Download and store all match details for a specific league. You can find league IDs on the OpenDota website.
    ```bash
    # Example: Fetch all matches for league ID 15728 (ESL One Birmingham 2024)
    python dota2draft_cli.py fetch-league 15728
    ```

### Database Querying & Statistics

Explore the data stored in your local database.

1.  **List and Search Leagues**: Find the `LEAGUE_ID` for a tournament.
    ```bash
    # List all leagues in the database
    python dota2draft_cli.py leagues list

    # Search for leagues containing a keyword
    python dota2draft_cli.py leagues search "International"
    ```

2.  **Get Statistics**: Calculate hero and player statistics. You can filter these by league and/or date.
    ```bash
    # Get hero pick/ban/win stats across all matches
    python dota2draft_cli.py stats heroes

    # Get player stats for a specific league
    python dota2draft_cli.py stats players --league-id 15728

    # Get hero stats for matches after a specific date (post-patch analysis)
    python dota2draft_cli.py stats heroes --after-date 2024-01-01
    ```

### Match-Specific Analysis

Once you have data, you can view and analyze it.

1.  **Get Match Draft**: Display the picks and bans for a specific match.
    ```bash
    python dota2draft_cli.py get-draft <MATCH_ID>
    ```

2.  **Analyze Lanes**: Perform a detailed laning-phase analysis for a match based on pre-configured KPIs.
    ```bash
    python dota2draft_cli.py analyze-lanes <MATCH_ID>
    ```

3.  **Export Analysis to CSV**: Run the lane analysis for all matches of a league in your database and export the results to a CSV file. This CSV is required for training the neural network.
    ```bash
    # This will create a 'lanes.csv' file by default
    python dota2draft_cli.py export-analysis <LEAGUE_ID>
    ```

### Neural Network

The `nn` subcommand contains all model-related operations.

1.  **Train the Model**: Train the neural network using the data from a CSV file (generated by the `export-analysis` command).
    ```bash
    # Use the default 'lanes.csv' and train for 50 epochs
    python dota2draft_cli.py nn train

    # Specify custom parameters
    python dota2draft_cli.py nn train --csv-file my_analysis.csv --epochs 100
    ```
    This will save the trained model weights to `dota_draft_predictor_weights.pth` and create a loss plot. All generated PNG image files (training loss, evaluation plots) will be saved in the `nn_artifacts/` directory.

## Configuration

The application's behavior can be customized through the `config.yaml` file. This file allows you to set default paths for the database, CSV outputs, and model weights, as well as configure parameters for the lane analysis KPIs and neural network architecture.

Many configuration values can be overridden at runtime using CLI options (e.g., `--out` for `export-analysis`, `--model-file` for `nn` commands).

2.  **Make Predictions**: Use the trained model to predict lane scores for a given draft string.
    ```bash
    python dota2draft_cli.py nn predict "Radiant Pick: Axe; Dire Pick: Juggernaut; Radiant Ban: Invoker; ..."
    ```
